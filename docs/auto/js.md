<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

*   [oaiJson][1]
    *   [Parameters][2]
*   [oaiText][3]
    *   [Parameters][4]
*   [makeOpenAICall][5]
    *   [Parameters][6]
*   [truncateContent][7]
    *   [Parameters][8]
*   [extractTextPreviewFromPdf][9]
    *   [Parameters][10]
*   [optionalAdminGate][11]
    *   [Parameters][12]
*   [methodNotAllowed][13]
    *   [Parameters][14]
*   [securityHeaders][15]
    *   [Parameters][16]
*   [basicRateLimit][17]
    *   [Parameters][18]
*   [loadChatThread][19]
    *   [Parameters][20]
*   [addBubble][21]
    *   [Parameters][22]
*   [hydrateIncludes][23]
*   [hydrateIncludes][24]
    *   [Parameters][25]
*   [ROUTE\_SEL][26]
*   [init][27]
    *   [Parameters][28]
*   [init][29]
    *   [Parameters][30]
*   [init][31]
    *   [Parameters][32]
*   [init][33]
    *   [Parameters][34]
*   [init][35]
    *   [Parameters][36]
*   [init][37]
    *   [Parameters][38]
*   [closeResultsModal][39]
*   [addSpecTag][40]
    *   [Parameters][41]
*   [getAllIntentRoutes][42]
    *   [Parameters][43]
*   [getIntentRouteById][44]
    *   [Parameters][45]
*   [createIntentRoute][46]
    *   [Parameters][47]
*   [updateIntentRoute][48]
    *   [Parameters][49]
*   [deleteIntentRoute][50]
    *   [Parameters][51]
*   [findMatchingRoute][52]
    *   [Parameters][53]
*   [getIntentRouteStats][54]
*   [logger][55]
*   [logger][56]
*   [logger][57]
*   [logger][58]
*   [logger][59]
*   [logger][60]
*   [findFactMatchByQuery][61]
    *   [Parameters][62]
*   [findFactsByDocument][63]
    *   [Parameters][64]
*   [findFactsByType][65]
    *   [Parameters][66]
*   [getFactStatistics][67]
*   [getAllPlaybooks][68]
    *   [Parameters][69]
*   [getPlaybookById][70]
    *   [Parameters][71]
*   [createPlaybook][72]
    *   [Parameters][73]
*   [updatePlaybook][74]
    *   [Parameters][75]
*   [deletePlaybook][76]
    *   [Parameters][77]
*   [getPlaybookHintsForGeneration][78]
    *   [Parameters][79]
*   [getPlaybookStats][80]
*   [checkPlaybookExists][81]
    *   [Parameters][82]
*   [insertSpecSuggestion][83]
    *   [Parameters][84]
*   [insertGoldenTest][85]
    *   [Parameters][86]
*   [insertPlaybookHint][87]
    *   [Parameters][88]
*   [insertEntityCandidate][89]
    *   [Parameters][90]
*   [insertDipReview][91]
    *   [Parameters][92]
*   [getSupabaseStorageClient][93]
*   [getSupabaseStorageClient][94]
*   [lookupSystemByManufacturerAndModel][95]
    *   [Parameters][96]
*   [getSystemByUid][97]
    *   [Parameters][98]
*   [updateSpecKeywords][99]
    *   [Parameters][100]
*   [listMinimal][101]
*   [get][102]
*   [get][103]
*   [get][104]
*   [get][105]
*   [get][106]
*   [get][107]
*   [get][108]
*   [get][109]
*   [get][110]
*   [get][111]
*   [get][112]
*   [get][113]
*   [Router][114]
*   [Router][115]
*   [Router][116]
*   [Router][117]
*   [Router][118]
*   [post][119]
*   [post][120]
*   [post][121]
*   [post][122]
*   [post][123]
*   [checkFileExists][124]
    *   [Parameters][125]
*   [delete][126]
*   [delete][127]
*   [expressJson][128]
*   [SystemUid][129]
*   [HashOrUuid][130]
*   [z][131]
*   [validateDIP][132]
    *   [Parameters][133]
*   [validateSuggestions][134]
    *   [Parameters][135]
*   [validateApplyRequest][136]
    *   [Parameters][137]
*   [validateRollbackRequest][138]
    *   [Parameters][139]
*   [createDefaultDIP][140]
    *   [Parameters][141]
*   [createDefaultSuggestions][142]
    *   [Parameters][143]
*   [SpecKeywordSchema][144]
*   [AcceptSpecPayload][145]
*   [uploadDocumentSchema][146]
*   [documentUploadRequestSchema][147]
*   [systemMetadataSchema][148]
*   [documentCreationSchema][149]
*   [generateEnhancedAssistantResponse][150]
    *   [Parameters][151]
*   [extractPressureSpecs][152]
    *   [Parameters][153]
*   [generatePressureResponse][154]
    *   [Parameters][155]
*   [generateStandardResponse][156]
    *   [Parameters][157]
*   [generateStructuredContent][158]
    *   [Parameters][159]
*   [detectResponseStyle][160]
    *   [Parameters][161]
*   [checkServiceAvailability][162]
*   [processUserMessage][163]
    *   [Parameters][164]
*   [processUserMessage][165]
    *   [Parameters][166]
*   [handleSpecialIntent][167]
    *   [Parameters][168]
*   [bootstrapContext][169]
    *   [Parameters][170]
*   [getOrCreateSessionAndThread][171]
    *   [Parameters][172]
*   [performPineconeRetrieval][173]
    *   [Parameters][174]
*   [createFactResponse][175]
    *   [Parameters][176]
*   [createFactResponse][177]
    *   [Parameters][178]
*   [storeMessagesAndUpdateThread][179]
    *   [Parameters][180]
*   [handleSummarizationIfNeeded][181]
    *   [Parameters][182]
*   [handleSummarizationIntent][183]
    *   [Parameters][184]
*   [handleAssetSummaryIntent][185]
    *   [Parameters][186]
*   [generateDIPAndSuggestions][187]
    *   [Parameters][188]
*   [getDocumentChunks][189]
    *   [Parameters][190]
*   [generateDIP][191]
    *   [Parameters][192]
*   [generateSuggestions][193]
    *   [Parameters][194]
*   [extractEntities][195]
    *   [Parameters][196]
*   [extractSpecifications][197]
    *   [Parameters][198]
*   [extractMaintenance][199]
    *   [Parameters][200]
*   [generateEntityAliases][201]
    *   [Parameters][202]
*   [generateIntentHints][203]
    *   [Parameters][204]
*   [generatePlaybookSuggestions][205]
    *   [Parameters][206]
*   [generateUnitSuggestions][207]
    *   [Parameters][208]
*   [generateGoldenTests][209]
    *   [Parameters][210]
*   [calculateConfidenceScore][211]
    *   [Parameters][212]
*   [calculateCompletenessScore][213]
    *   [Parameters][214]
*   [storeDIP][215]
    *   [Parameters][216]
*   [storeSuggestions][217]
    *   [Parameters][218]
*   [generateDIP][219]
    *   [Parameters][220]
*   [runDIPPacket][221]
    *   [Parameters][222]
*   [checkDIPAvailability][223]
*   [getDIPStats][224]
    *   [Parameters][225]
*   [extractTextPreview][226]
    *   [Parameters][227]
*   [extractFromDatabase][228]
    *   [Parameters][229]
*   [extractFromStorage][230]
    *   [Parameters][231]
*   [getFromCache][232]
    *   [Parameters][233]
*   [setCache][234]
    *   [Parameters][235]
*   [getTextExtractionMetrics][236]
*   [clearTextCache][237]
*   [getCacheStats][238]
*   [retrieveWithSpecBias][239]
    *   [Parameters][240]
*   [retrieveWithSpecBias][241]
    *   [Parameters][242]
*   [findFactMatch][243]
    *   [Parameters][244]
*   [getFactFirstResponse][245]
    *   [Parameters][246]
*   [shouldAttemptFactFirst][247]
    *   [Parameters][248]
*   [classifyUserIntent][249]
    *   [Parameters][250]
*   [routeQuery][251]
    *   [Parameters][252]
*   [searchDocuments][253]
    *   [Parameters][254]
*   [normalizeQuery][255]
    *   [Parameters][256]
*   [fs][257]
*   [fs][258]
*   [fs][259]
*   [fs][260]
*   [applySuggestions][261]
    *   [Parameters][262]
*   [readJson][263]
    *   [Parameters][264]
*   [writeJson][265]
    *   [Parameters][266]
*   [mergeJsonMapArray][267]
    *   [Parameters][268]
*   [mergeIntentHints][269]
    *   [Parameters][270]
*   [mergeMaintenanceLexicon][271]
    *   [Parameters][272]
*   [mergeUnits][273]
    *   [Parameters][274]
*   [writeGoldenTests][275]
    *   [Parameters][276]
*   [safeName][277]
    *   [Parameters][278]
*   [SuggestionsMergeService][279]
    *   [mergeSpecSuggestions][280]
        *   [Parameters][281]
    *   [mergeEntityCandidates][282]
        *   [Parameters][283]
    *   [mergePlaybookHints][284]
        *   [Parameters][285]
    *   [acceptSpecSuggestion][286]
        *   [Parameters][287]
    *   [upsertSpec][288]
        *   [Parameters][289]
    *   [mergeAllSuggestions][290]
        *   [Parameters][291]
*   [summarizeThread][292]
    *   [Parameters][293]
*   [generateThreadName][294]
    *   [Parameters][295]
*   [generateSystemSummary][296]
    *   [Parameters][297]
*   [shouldSummarizeThread][298]
    *   [Parameters][299]
*   [getSummarizationMetadata][300]
    *   [Parameters][301]
*   [refreshKnowledgeFactsView][302]
*   [refreshKnowledgeFactsViewSafe][303]
*   [getViewRefreshStats][304]
*   [checkViewHealth][305]
*   [][306]
*   [processor][307]
*   [ensureLexicons][308]
*   [ensureFile][309]
    *   [Parameters][310]
*   [defaultMaintenance][311]
*   [defaultUnits][312]
*   [isFollowUpQuestion][313]
    *   [Parameters][314]
*   [containsAmbiguousPronoun][315]
    *   [Parameters][316]
*   [extractEquipmentTerms][317]
    *   [Parameters][318]
*   [hasExistingSystemsContext][319]
    *   [Parameters][320]
*   [getExistingSystemsContext][321]
    *   [Parameters][322]
*   [contextRewrite][323]
    *   [Parameters][324]
*   [withTimeout][325]
    *   [Parameters][326]
*   [formatFactAnswer][327]
    *   [Parameters][328]
*   [formatSpecAnswer][329]
    *   [Parameters][330]
*   [formatIntentAnswer][331]
    *   [Parameters][332]
*   [formatGoldenTestAnswer][333]
    *   [Parameters][334]
*   [formatMultipleFacts][335]
    *   [Parameters][336]
*   [FuzzyMatcher][337]
    *   [Parameters][338]
    *   [levenshteinDistance][339]
        *   [Parameters][340]
    *   [findBestMatch][341]
        *   [Parameters][342]
    *   [findMultipleMatches][343]
        *   [Parameters][344]
    *   [isLikelyTypo][345]
        *   [Parameters][346]
*   [decideStyle][347]
    *   [Parameters][348]
*   [getStyleOpening][349]
    *   [Parameters][350]
*   [startTimer][351]
    *   [Parameters][352]
*   [endTimer][353]
    *   [Parameters][354]
*   [recordMetric][355]
    *   [Parameters][356]
*   [incrementCounter][357]
    *   [Parameters][358]
*   [recordSuccess][359]
    *   [Parameters][360]
*   [getMetrics][361]
*   [getOperationSummary][362]
    *   [Parameters][363]
*   [getSuccessRate][364]
    *   [Parameters][365]
*   [reset][366]
*   [\_buildKey][367]
    *   [Parameters][368]
*   [getDashboardMetrics][369]
*   [\_calculatePerformanceScore][370]
    *   [Parameters][371]
*   [getPerformanceMetrics][372]
    *   [Parameters][373]
*   [createSnapshot][374]
    *   [Parameters][375]
*   [rollbackTo][376]
    *   [Parameters][377]
*   [listSnapshots][378]
*   [deleteSnapshot][379]
    *   [Parameters][380]
*   [getSnapshotInfo][381]
    *   [Parameters][382]
*   [cleanupSnapshots][383]
    *   [Parameters][384]
*   [listFiles][385]
    *   [Parameters][386]
*   [loadMaintenanceLexicon][387]
*   [extractMaintenanceTerms][388]
    *   [Parameters][389]
*   [checkMaintenanceContent][390]
    *   [Parameters][391]
*   [filterSpecLike][392]
    *   [Parameters][393]
*   [loadUnitsLexicon][394]
*   [getUnitCategory][395]
    *   [Parameters][396]
*   [checkDisambiguation][397]
    *   [Parameters][398]
*   [normalizeUnitToken][399]
    *   [Parameters][400]
*   [normalizeUnitsInText][401]
    *   [Parameters][402]
*   [getUnitCategories][403]
*   [getUnitsInCategory][404]
    *   [Parameters][405]

## oaiJson

Makes a structured JSON API call to OpenAI

### Parameters

*   `params` **[Object][406]** Configuration object

    *   `params.system` **[string][407]** System prompt
    *   `params.user` **[string][407]** User prompt
    *   `params.schema` **[Object][406]** JSON schema for structured output
    *   `params.model` **[string][407]** OpenAI model to use
    *   `params.maxOutputTokens` **[number][408]** Maximum tokens to generate
    *   `params.seed` **[number][408]** Seed for deterministic output

Returns **[Promise][409]<[Object][406]>** Parsed JSON response

## oaiText

Makes a natural language API call to OpenAI

### Parameters

*   `params` **[Object][406]** Configuration object

    *   `params.system` **[string][407]** System prompt
    *   `params.user` **[string][407]** User prompt
    *   `params.model` **[string][407]** OpenAI model to use
    *   `params.maxOutputTokens` **[number][408]** Maximum tokens to generate
    *   `params.seed` **[number][408]** Seed for deterministic output
    *   `params.style` **[string][407]** Style preset for temperature control (optional, default `'brief'`)

Returns **[Promise][409]<[string][407]>** Generated text response

## makeOpenAICall

Makes the actual OpenAI API call with retry logic

### Parameters

*   `requestBody` **[Object][406]** Request body for OpenAI API
*   `openaiApiKey` **[string][407]** API key
*   `timeoutMs` **[number][408]** Timeout in milliseconds
*   `retryAttempts` **[number][408]** Number of retry attempts

Returns **[Promise][409]<[Object][406]>** OpenAI API response

## truncateContent

Truncates text content to specified length

### Parameters

*   `text` **[string][407]** Text to truncate
*   `maxLength` **[number][408]** Maximum length (optional, default `600`)

Returns **[string][407]** Truncated text

## extractTextPreviewFromPdf

Extract text preview from multiple sources in priority order:

1.  Supabase Storage: documents/manuals/<docId>/text/preview\.txt or text/page-\*.txt
2.  Postgres table: document\_chunks (fallback)
3.  Log warning if neither available

### Parameters

*   `docId` &#x20;
*   `options`   (optional, default `{}`)

## optionalAdminGate

Optional admin gate - only checks if token is provided
Useful for routes that can work with or without admin access

### Parameters

*   `req` &#x20;
*   `res` &#x20;
*   `next` &#x20;

## methodNotAllowed

Middleware to handle method not allowed (405) responses

### Parameters

*   `req` **[Object][406]** Express request object
*   `res` **[Object][406]** Express response object
*   `next` **[Function][410]** Express next function

## securityHeaders

Security middleware - adds essential security headers
Equivalent to Helmet.js but lightweight and customized

### Parameters

*   `req` &#x20;
*   `res` &#x20;
*   `next` &#x20;

## basicRateLimit

Rate limiting middleware (basic implementation)
In production, consider using express-rate-limit

### Parameters

*   `req` &#x20;
*   `res` &#x20;
*   `next` &#x20;

## loadChatThread

Load chat thread history for a session

### Parameters

*   `sessionId` **[string][407]** The session ID to load

## addBubble

Add a chat bubble to the UI
Maps roles to the existing UI functions

### Parameters

*   `role` **[string][407]** 'user' or 'assistant'
*   `content` **[string][407]** Message content
*   `metadata` **[object][406]** Optional message metadata (optional, default `{}`)

## hydrateIncludes

Admin boot script
Initializes the admin interface with includes and routing

## hydrateIncludes

Tiny HTML include loader
Fetches HTML partials and injects them into elements with data-include attributes

### Parameters

*   `root`   (optional, default `document`)

## ROUTE\_SEL

Simple hash-based router
Shows/hides sections based on URL hash

Type: [string][407]

## init

Chunks section controller
Handles chunk management and viewing

### Parameters

*   `$0` **[Object][406]**&#x20;

    *   `$0.router` &#x20;
    *   `$0.adminState` &#x20;

## init

Dashboard section controller
Handles system health, database status, and logs

### Parameters

*   `$0` **[Object][406]**&#x20;

    *   `$0.router` &#x20;
    *   `$0.adminState` &#x20;

## init

DIP section controller
Handles Document Intelligence Packet generation and management

### Parameters

*   `$0` **[Object][406]**&#x20;

    *   `$0.router` &#x20;
    *   `$0.adminState` &#x20;

## init

Health section controller
Handles system health monitoring

### Parameters

*   `$0` **[Object][406]**&#x20;

    *   `$0.router` &#x20;
    *   `$0.adminState` &#x20;

## init

Metrics section controller
Handles system metrics and performance monitoring

### Parameters

*   `$0` **[Object][406]**&#x20;

    *   `$0.router` &#x20;
    *   `$0.adminState` &#x20;

## init

Suggestions section controller
Handles AI-generated suggestions management and approval workflow

### Parameters

*   `$0` **[Object][406]**&#x20;

    *   `$0.router` &#x20;
    *   `$0.adminState` &#x20;

## closeResultsModal

Shared utilities and global functions for the admin interface
These functions are referenced in HTML and need to be available globally

## addSpecTag

Add spec tag to document chunk metadata for retrieval boost

### Parameters

*   `chunkId` &#x20;
*   `tag` &#x20;

## getAllIntentRoutes

Get all intent routes with optional filtering

### Parameters

*   `filters`   (optional, default `{}`)

## getIntentRouteById

Get a specific intent route by ID

### Parameters

*   `id` &#x20;

## createIntentRoute

Create a new intent route

### Parameters

*   `routeData` &#x20;
*   `createdBy`   (optional, default `'admin'`)

## updateIntentRoute

Update an existing intent route

### Parameters

*   `id` &#x20;
*   `updates` &#x20;
*   `updatedBy`   (optional, default `'admin'`)

## deleteIntentRoute

Delete an intent route

### Parameters

*   `id` &#x20;

## findMatchingRoute

Find the best matching intent route for a query

### Parameters

*   `query` &#x20;

## getIntentRouteStats

Get intent route statistics

## logger

Knowledge Repository
Handles fact-first retrieval from approved DIP suggestions

## logger

Suggestions Repository
Handles database operations for DIP suggestion approval

## logger

DIP Service
Handles Document Intelligence Packet processing via Python sidecar

## logger

Document Text Extraction Service
Multi-source text extractor: DB chunks → Storage text → graceful fallback
Includes caching and performance monitoring

## logger

Answer Formatter Utility
Formats fact matches into user-friendly responses

## logger

Metrics collection utility for tracking fuzzy matching and context operations
Provides performance monitoring and success rate tracking

## findFactMatchByQuery

Find fact match by query string
Searches across all fact types in the knowledge\_facts view

### Parameters

*   `query` &#x20;

## findFactsByDocument

Find all facts for a specific document

### Parameters

*   `docId` &#x20;

## findFactsByType

Find facts by type

### Parameters

*   `factType` &#x20;

## getFactStatistics

Get fact statistics

## getAllPlaybooks

Get all playbooks with optional filtering

### Parameters

*   `filters`   (optional, default `{}`)

## getPlaybookById

Get a specific playbook by ID

### Parameters

*   `playbookId` &#x20;

## createPlaybook

Create a new playbook with steps

### Parameters

*   `playbookData` &#x20;
*   `steps`   (optional, default `[]`)
*   `createdBy`   (optional, default `'system'`)

## updatePlaybook

Update an existing playbook

### Parameters

*   `playbookId` &#x20;
*   `updates` &#x20;
*   `updatedBy`   (optional, default `'system'`)

## deletePlaybook

Delete a playbook (cascades to steps)

### Parameters

*   `playbookId` &#x20;

## getPlaybookHintsForGeneration

Get playbook hints grouped by system/subsystem for generation

### Parameters

*   `filters`   (optional, default `{}`)

## getPlaybookStats

Get playbook statistics

## checkPlaybookExists

Check if a playbook already exists for a system/subsystem combination

### Parameters

*   `systemNorm` &#x20;
*   `subsystemNorm` &#x20;

## insertSpecSuggestion

Insert approved spec suggestion

### Parameters

*   `doc_id` &#x20;
*   `suggestion` &#x20;
*   `approved_by`   (optional, default `'admin'`)

## insertGoldenTest

Insert approved golden test

### Parameters

*   `doc_id` &#x20;
*   `test` &#x20;
*   `approved_by`   (optional, default `'admin'`)

## insertPlaybookHint

Insert approved playbook hint

### Parameters

*   `doc_id` &#x20;
*   `hint` &#x20;
*   `approved_by`   (optional, default `'admin'`)

## insertEntityCandidate

Insert entity candidate

### Parameters

*   `doc_id` &#x20;
*   `entity` &#x20;
*   `approved_by`   (optional, default `'admin'`)

## insertDipReview

Insert DIP review audit log (optional)

### Parameters

*   `doc_id` &#x20;
*   `suggestion_type` &#x20;
*   `content` &#x20;
*   `approved_by`   (optional, default `'admin'`)

## getSupabaseStorageClient

👇 compat shim for older code

## getSupabaseStorageClient

DIP (Document Intelligence Packet) generation service
Generates DIP and Suggestions files after document processing
This service can be called after document ingestion is complete

## lookupSystemByManufacturerAndModel

Lookup system metadata by normalized manufacturer and model names
Used during document upload to resolve asset\_uid and system metadata

### Parameters

*   `manufacturerNorm` **[string][407]** Normalized manufacturer name
*   `modelNorm` **[string][407]** Normalized model name

<!---->

*   Throws **[Error][411]** If system not found or database error

Returns **[Promise][409]<[Object][406]>** System metadata with asset\_uid, system\_norm, subsystem\_norm

## getSystemByUid

Get system by UUID with spec\_keywords

### Parameters

*   `systemUid` &#x20;

## updateSpecKeywords

Update spec keywords for a system

### Parameters

*   `systemUid` &#x20;
*   `next` &#x20;

## listMinimal

List minimal system data for admin dropdowns

## get

GET /admin/docs/chunks/:docId
Get document chunks for a specific document

## get

GET /admin/dip/status/:docId
Check if DIP and Suggestions exist for a document

## get

GET /admin/dip/download/:docId
Download DIP file for a document

## get

GET /admin/suggestions/download/:docId
Download Suggestions file for a document

## get

GET /admin/jobs/queue
List queued jobs for inspection

## get

GET /admin/jobs/status
Get job processor status

## get

GET /admin/snapshots
List all available snapshots

## get

GET /admin/snapshots/:snapshotId
Get detailed information about a specific snapshot

## get

GET /admin/api/systems/minimal
Get minimal system data for admin dropdowns

## get

GET /admin/text-extraction/metrics
Get text extraction performance metrics

## get

GET /admin/text-extraction/cache
Get cache statistics and status

## get

GET /admin/text-extraction/health
Get overall health status of text extraction service

## Router

Admin DIP generation route
Provides endpoint to generate DIP and Suggestions for processed documents

## Router

Admin jobs management route
Provides manual job processing triggers for testing and debugging

## Router

Admin snapshots route - Rollback functionality and snapshot management
Provides endpoints for managing snapshots and rolling back changes

## Router

Admin Suggestions Route
Handles DIP suggestion review and approval

## Router

Admin Text Extraction Metrics Route
Provides endpoints to monitor text extraction performance and cache status

## post

POST /admin/dip/generate/:docId
Generate DIP and Suggestions for a document

## post

POST /admin/jobs/process-next
Manually trigger processing of the next queued job

## post

POST /admin/snapshots/rollback
Rollback to a specific snapshot

## post

POST /admin/snapshots/cleanup
Clean up old snapshots (keep only the most recent N)

## post

POST /admin/api/suggestions/spec/accept
Accept a spec suggestion and merge it into production

## checkFileExists

Helper function to check if file exists in storage

### Parameters

*   `storage` **[Object][406]** Supabase Storage client
*   `fileName` **[string][407]** File name to check

Returns **[Promise][409]<[boolean][412]>** True if file exists

## delete

DELETE /admin/snapshots/:snapshotId
Delete a specific snapshot

## delete

DELETE /admin/text-extraction/cache
Clear the text extraction cache

## expressJson

Express JSON middleware (simplified)

Returns **[Function][410]** Express middleware

## SystemUid

Schema for validating UUIDs
Used for systems.asset\_uid which is a UUID

## HashOrUuid

Schema for validating hash-based or UUID-based IDs
Used for documents.doc\_id which can be either format

## z

Ingestion schemas for DIP (Document Intelligence Packet) and Suggestions
Provides validation for document analysis results and admin suggestions

## validateDIP

Validate a DIP object

### Parameters

*   `obj` **any** Object to validate

Returns **[Object][406]** Validation result with success flag and data/error

## validateSuggestions

Validate a Suggestions object

### Parameters

*   `obj` **any** Object to validate

Returns **[Object][406]** Validation result with success flag and data/error

## validateApplyRequest

Validate an Apply Request object

### Parameters

*   `obj` **any** Object to validate

Returns **[Object][406]** Validation result with success flag and data/error

## validateRollbackRequest

Validate a Rollback Request object

### Parameters

*   `obj` **any** Object to validate

Returns **[Object][406]** Validation result with success flag and data/error

## createDefaultDIP

Create a default DIP structure

### Parameters

*   `docId` **[string][407]** Document ID

Returns **[Object][406]** Default DIP structure

## createDefaultSuggestions

Create a default Suggestions structure

### Parameters

*   `docId` **[string][407]** Document ID

Returns **[Object][406]** Default Suggestions structure

## SpecKeywordSchema

Schema for spec keyword suggestions

## AcceptSpecPayload

Schema for accepting spec suggestions

## uploadDocumentSchema

Schema for validating normalized document upload metadata
Ensures manufacturer\_norm and model\_norm are provided and non-empty

## documentUploadRequestSchema

Schema for validating the complete document upload request
Extends the base schema with optional fields for backward compatibility

## systemMetadataSchema

Schema for validating system metadata lookup response
Used to ensure system lookup returns required fields

## documentCreationSchema

Schema for validating document creation payload
Includes all fields that will be stored in the documents table

## generateEnhancedAssistantResponse

Generate enhanced assistant response from Pinecone results

### Parameters

*   `userQuery` **[string][407]** Original user query
*   `enhancedQuery` **[string][407]** Enhanced query with context
*   `systemsContext` **[Array][413]** Systems context array
*   `pineconeResults` **[Array][413]** Pinecone search results
*   `pineconeError` **([Error][411] | null)** Any Pinecone error
*   `recentMessages` **[Array][413]** Recent conversation messages

Returns **[Promise][409]<[Object][406]>** Generated response with content and sources

## extractPressureSpecs

Extract pressure specifications from Pinecone results

### Parameters

*   `pineconeResults` **[Array][413]** Pinecone search results

Returns **[Array][413]** Pressure specifications

## generatePressureResponse

Generate pressure-specific response

### Parameters

*   `pressureSpecs` **[Array][413]** Pressure specifications

Returns **[string][407]** Formatted pressure response

## generateStandardResponse

Generate standard response from Pinecone results

### Parameters

*   `userQuery` **[string][407]** User query
*   `systemsContext` **[Array][413]** Systems context
*   `pineconeResults` **[Array][413]** Pinecone results
*   `sources` **[Array][413]** Sources array

Returns **[Promise][409]<[string][407]>** Generated response

## generateStructuredContent

Generate structured content from Pinecone result

### Parameters

*   `result` **[Object][406]** Pinecone result

Returns **[string][407]** Structured content

## detectResponseStyle

Detect response style for the query

### Parameters

*   `userQuery` **[string][407]** User query

Returns **([string][407] | null)** Detected style

## checkServiceAvailability

Check if required services are available

Returns **[Promise][409]\<void>**&#x20;

## processUserMessage

Main chat processing function - orchestrates the entire chat flow

### Parameters

*   `userQuery` **[string][407]** User's query
*   `options` **[Object][406]** Processing options (optional, default `{}`)

    *   `options.sessionId` **[string][407]** Session ID
    *   `options.threadId` **[string][407]** Thread ID
    *   `options.contextSize` **[number][408]** Context size (optional, default `5`)
    *   `options.normalizedMessage` **[string][407]** Normalized version of user query

Returns **[Promise][409]<[Object][406]>** Complete chat response

## processUserMessage

Legacy processUserMessage function - delegates to new orchestrator

### Parameters

*   `userQuery` **[string][407]** User's query
*   `options` **[Object][406]** Processing options (optional, default `{}`)

Returns **[Promise][409]<[Object][406]>** Complete chat response

## handleSpecialIntent

Handle special intents (summarize, asset\_summary)

### Parameters

*   `userQuery` **[string][407]** User query
*   `routingResult` **[Object][406]** Routing result
*   `options` **[Object][406]** Options

Returns **[Promise][409]<[Object][406]>** Special intent response

## bootstrapContext

Bootstrap context for processing

### Parameters

*   `userQuery` **[string][407]** User query
*   `options` **[Object][406]** Options

    *   `options.effectiveQuery` **[string][407]** Effective query to use for searches

Returns **[Promise][409]<[Object][406]>** Bootstraped context

## getOrCreateSessionAndThread

Get or create session and thread

### Parameters

*   `options` **[Object][406]** Options

Returns **[Promise][409]<[Object][406]>** Session and thread IDs

## performPineconeRetrieval

Perform Pinecone retrieval

### Parameters

*   `userQuery` **[string][407]** User query
*   `context` **[Object][406]** Processing context

Returns **[Promise][409]<[Object][406]>** Pinecone results

## createFactResponse

Create fact-first response

### Parameters

*   `factResponse` **[Object][406]** Fact response
*   `context` **[Object][406]** Processing context

Returns **[Promise][409]<[Object][406]>** Complete response

## createFactResponse

Create a structured response object

### Parameters

*   `fact` &#x20;
*   `query` &#x20;

## storeMessagesAndUpdateThread

Store messages and update thread

### Parameters

*   `userQuery` **[string][407]** User query
*   `assistantResponse` **[Object][406]** Assistant response
*   `context` **[Object][406]** Processing context

Returns **[Promise][409]<[Object][406]>** Complete response

## handleSummarizationIfNeeded

Handle summarization if needed

### Parameters

*   `context` **[Object][406]** Processing context
*   `result` **[Object][406]** Processing result

## handleSummarizationIntent

Handle summarization intent

### Parameters

*   `userQuery` **[string][407]** User query
*   `options` **[Object][406]** Options

Returns **[Promise][409]<[Object][406]>** Summarization response

## handleAssetSummaryIntent

Handle asset summary intent

### Parameters

*   `userQuery` **[string][407]** User query
*   `options` **[Object][406]** Options

Returns **[Promise][409]<[Object][406]>** Asset summary response

## generateDIPAndSuggestions

Generate DIP and Suggestions for a processed document

### Parameters

*   `docId` **[string][407]** Document ID
*   `options` **[Object][406]** Generation options (optional, default `{}`)

Returns **[Promise][409]<[Object][406]>** Generation result

## getDocumentChunks

Get document chunks using the new text extraction service

### Parameters

*   `docId` **[string][407]** Document ID

Returns **[Promise][409]<[Array][413]>** Document chunks

## generateDIP

Generate DIP from document chunks

### Parameters

*   `docId` **[string][407]** Document ID
*   `chunks` **[Array][413]** Document chunks
*   `options` **[Object][406]** Generation options (optional, default `{}`)

Returns **[Promise][409]<[Object][406]>** Generated DIP

## generateSuggestions

Generate Suggestions from DIP

### Parameters

*   `docId` **[string][407]** Document ID
*   `dip` **[Object][406]** Generated DIP
*   `options` **[Object][406]** Generation options (optional, default `{}`)

Returns **[Promise][409]<[Object][406]>** Generated Suggestions

## extractEntities

Extract entities from chunks

### Parameters

*   `chunks` **[Array][413]** Document chunks

Returns **[Object][406]** Extracted entities

## extractSpecifications

Extract specifications from chunks

### Parameters

*   `chunks` **[Array][413]** Document chunks

Returns **[Object][406]** Extracted specifications

## extractMaintenance

Extract maintenance information from chunks

### Parameters

*   `chunks` **[Array][413]** Document chunks

Returns **[Object][406]** Extracted maintenance info

## generateEntityAliases

Generate entity alias suggestions

### Parameters

*   `entities` **[Object][406]** Extracted entities

Returns **[Object][406]** Entity alias suggestions

## generateIntentHints

Generate intent hints

### Parameters

*   `maintenance` **[Object][406]** Maintenance information

Returns **[Array][413]** Intent hints

## generatePlaybookSuggestions

Generate playbook suggestions

### Parameters

*   `maintenance` **[Object][406]** Maintenance information

Returns **[Object][406]** Playbook suggestions

## generateUnitSuggestions

Generate unit suggestions

### Parameters

*   `specifications` **[Object][406]** Specifications

Returns **[Array][413]** Unit suggestions

## generateGoldenTests

Generate golden test suggestions

### Parameters

*   `maintenance` **[Object][406]** Maintenance information

Returns **[Array][413]** Golden test suggestions

## calculateConfidenceScore

Calculate confidence score

### Parameters

*   `chunks` **[Array][413]** Document chunks

Returns **[number][408]** Confidence score

## calculateCompletenessScore

Calculate completeness score

### Parameters

*   `chunks` **[Array][413]** Document chunks

Returns **[number][408]** Completeness score

## storeDIP

Store DIP in Supabase Storage

### Parameters

*   `storage` **[Object][406]** Supabase Storage client
*   `docId` **[string][407]** Document ID
*   `dip` **[Object][406]** DIP data

Returns **[Promise][409]\<void>**&#x20;

## storeSuggestions

Store Suggestions in Supabase Storage

### Parameters

*   `storage` **[Object][406]** Supabase Storage client
*   `docId` **[string][407]** Document ID
*   `suggestions` **[Object][406]** Suggestions data

Returns **[Promise][409]\<void>**&#x20;

## generateDIP

Generate DIP from document file

### Parameters

*   `fileBuffer` **[Buffer][414]** The PDF file buffer
*   `docId` **[string][407]** Document ID
*   `fileName` **[string][407]** File name
*   `options` **[Object][406]** Processing options (optional, default `{}`)

Returns **[Object][406]** DIP generation result

## runDIPPacket

Run complete DIP packet processing and save files

### Parameters

*   `docId` **[string][407]** Document ID
*   `filePath` **[string][407]** Path to the PDF file
*   `outputDir` **[string][407]** Output directory for DIP files
*   `options` **[Object][406]** Processing options (optional, default `{}`)

Returns **[Object][406]** DIP packet processing result

## checkDIPAvailability

Check if DIP processing is available

Returns **[boolean][412]** True if DIP processing is available

## getDIPStats

Get DIP processing statistics

### Parameters

*   `docId` **[string][407]** Document ID

Returns **[Object][406]** DIP statistics

## extractTextPreview

Extract text preview from document using multiple sources
Priority: Cache → DB chunks → Storage → Empty fallback

### Parameters

*   `docId` **[string][407]** Document ID
*   `options` **[Object][406]** Extraction options (optional, default `{}`)

    *   `options.maxPages` **[number][408]** Maximum pages to extract (default: 6)
    *   `options.useCache` **[boolean][412]** Whether to use cache (default: true)

Returns **[Promise][409]<[Object][406]>** Text extraction result

## extractFromDatabase

Extract text from database chunks

### Parameters

*   `docId` **[string][407]** Document ID
*   `maxPages` **[number][408]** Maximum pages to extract
*   `requestLogger` **[Object][406]** Logger instance

Returns **[Promise][409]<[Object][406]>** Extraction result

## extractFromStorage

Extract text from storage files

### Parameters

*   `docId` **[string][407]** Document ID
*   `maxPages` **[number][408]** Maximum pages to extract
*   `requestLogger` **[Object][406]** Logger instance

Returns **[Promise][409]<[Object][406]>** Extraction result

## getFromCache

Get text from cache

### Parameters

*   `docId` **[string][407]** Document ID

Returns **([Object][406] | null)** Cached result or null

## setCache

Set text in cache

### Parameters

*   `docId` **[string][407]** Document ID
*   `result` **[Object][406]** Text extraction result

## getTextExtractionMetrics

Get performance metrics

Returns **[Object][406]** Current metrics

## clearTextCache

Clear cache

## getCacheStats

Get cache statistics

Returns **[Object][406]** Cache stats

## retrieveWithSpecBias

Legacy retrieveWithSpecBias function - delegates to new service

### Parameters

*   `params` **[Object][406]** Retrieval parameters

Returns **[Promise][409]<[Object][406]>** Retrieval results

## retrieveWithSpecBias

Perform spec-biased retrieval from Pinecone

### Parameters

*   `params` **[Object][406]** Retrieval parameters

    *   `params.query` **[string][407]** The search query
    *   `params.namespace` **[string][407]** Pinecone namespace
    *   `params.context` **[Object][406]** Additional context (optional, default `{}`)

Returns **[Promise][409]<[Object][406]>** Retrieval results with metadata

## findFactMatch

Check if query matches any facts in the knowledge\_facts materialized view

### Parameters

*   `query` **[string][407]** The user query

Returns **[Promise][409]<([Object][406] | null)>** Fact match result or null

## getFactFirstResponse

Get fact-first response for a query

### Parameters

*   `query` **[string][407]** The user query
*   `context` **[Object][406]** Additional context (optional, default `{}`)

Returns **[Promise][409]<([Object][406] | null)>** Formatted fact response or null

## shouldAttemptFactFirst

Check if fact-first retrieval should be attempted

### Parameters

*   `query` **[string][407]** The user query
*   `context` **[Object][406]** Additional context (optional, default `{}`)

Returns **[boolean][412]** True if fact-first should be attempted

## classifyUserIntent

Classify user query intent and determine processing pipeline

### Parameters

*   `userQuery` **[string][407]** The user's query

Returns **[Promise][409]<[Object][406]>** Intent classification result

## routeQuery

Route query to appropriate processing pipeline based on intent

### Parameters

*   `userQuery` **[string][407]** The user's query
*   `context` **[Object][406]** Processing context (optional, default `{}`)

Returns **[Promise][409]<[Object][406]>** Routing decision

## searchDocuments

Perform standard Pinecone search without spec bias

### Parameters

*   `query` &#x20;
*   `context`   (optional, default `{}`)
*   `params` **[Object][406]** Search parameters

    *   `params.query` **[string][407]** The search query
    *   `params.context` **[Object][406]** Search context

Returns **[Promise][409]<[Object][406]>** Search results

## normalizeQuery

Normalize user query by removing common filler phrases

### Parameters

*   `raw` **[string][407]** Raw user input

Returns **[string][407]** Normalized query

## fs

Suggestions apply service - merges accepted suggestions into JSON config files
Provides safe application of admin-approved changes with snapshot safety

## fs

Config guard service - ensure critical lexicon files exist
Seeds defaults if missing to make startup resilient

## fs

Snapshot service for safe configuration file management
Provides version control and rollback capabilities for JSON config files

## fs

Units normalization utility with fuzzy matching support
Handles unit typos and provides canonical unit forms

## applySuggestions

Apply accepted suggestions to configuration files

### Parameters

*   `params` **[Object][406]** Apply parameters

    *   `params.docId` **[string][407]** Document ID
    *   `params.accepted` **[Object][406]** Accepted suggestions (subset of SuggestionsSchema)
    *   `params.options` **[Object][406]** Apply options (optional, default `{}`)

Returns **[Promise][409]<[Object][406]>** Apply result with snapshot ID and change counts

## readJson

Read JSON file with fallback

### Parameters

*   `filePath` **[string][407]** File path
*   `fallback` **any** Fallback value if file doesn't exist (optional, default `{}`)

Returns **[Promise][409]\<any>** Parsed JSON or fallback

## writeJson

Write JSON file

### Parameters

*   `filePath` **[string][407]** File path
*   `data` **any** Data to write
*   `dryRun` **[boolean][412]** If true, don't actually write (optional, default `false`)

Returns **[Promise][409]\<void>**&#x20;

## mergeJsonMapArray

Merge JSON map arrays (for entities aliases)

### Parameters

*   `targetFile` **[string][407]** Target file path
*   `addMap` **[Object][406]** Map of keys to arrays to add
*   `dryRun` **[boolean][412]** If true, don't actually write (optional, default `false`)

Returns **[Promise][409]<[number][408]>** Number of items added

## mergeIntentHints

Merge intent hints into intents configuration

### Parameters

*   `filePath` **[string][407]** Intents file path
*   `hints` **[Array][413]** Intent hints to add
*   `dryRun` **[boolean][412]** If true, don't actually write (optional, default `false`)

Returns **[Promise][409]<[number][408]>** Number of hints added

## mergeMaintenanceLexicon

Merge maintenance lexicon with playbook suggestions

### Parameters

*   `filePath` **[string][407]** Maintenance file path
*   `playbooks` **[Object][406]** Playbook suggestions
*   `dryRun` **[boolean][412]** If true, don't actually write (optional, default `false`)

Returns **[Promise][409]<[number][408]>** Number of items added

## mergeUnits

Merge units suggestions into units configuration

### Parameters

*   `filePath` **[string][407]** Units file path
*   `suggestions` **[Array][413]** Unit suggestions to add
*   `dryRun` **[boolean][412]** If true, don't actually write (optional, default `false`)

Returns **[Promise][409]<[number][408]>** Number of units added

## writeGoldenTests

Write golden test files

### Parameters

*   `docId` **[string][407]** Document ID
*   `goldenTests` **[Array][413]** Test cases to write
*   `dryRun` **[boolean][412]** If true, don't actually write (optional, default `false`)

Returns **[Promise][409]<[number][408]>** Number of tests written

## safeName

Create safe filename from string

### Parameters

*   `name` **[string][407]** Name to make safe

Returns **[string][407]** Safe filename

## SuggestionsMergeService

Service to merge approved suggestions into production tables
This is the missing piece that connects suggestion approval to actual system behavior

### mergeSpecSuggestions

Merge approved spec suggestions into systems.spec\_keywords

#### Parameters

*   `docId` **[string][407]** Document ID
*   `specSuggestions` **[Array][413]** Approved spec suggestions

Returns **[Promise][409]<[Object][406]>** Merge result

### mergeEntityCandidates

Merge approved entity candidates into systems.synonyms

#### Parameters

*   `docId` **[string][407]** Document ID
*   `entityCandidates` **[Array][413]** Approved entity candidates

Returns **[Promise][409]<[Object][406]>** Merge result

### mergePlaybookHints

Merge approved playbook hints into playbooks table

#### Parameters

*   `docId` **[string][407]** Document ID
*   `playbookHints` **[Array][413]** Approved playbook hints

Returns **[Promise][409]<[Object][406]>** Merge result

### acceptSpecSuggestion

Accept a spec suggestion and merge it into production

#### Parameters

*   `params` **[Object][406]** Acceptance parameters

    *   `params.suggestionId` &#x20;
    *   `params.actor` &#x20;
    *   `params.systemUid` &#x20;
    *   `params.spec` &#x20;

Returns **[Promise][409]<[Object][406]>** Acceptance result

### upsertSpec

Helper function to upsert spec into array

#### Parameters

*   `array` &#x20;
*   `spec` &#x20;

### mergeAllSuggestions

Merge all approved suggestions into production tables

#### Parameters

*   `docId` **[string][407]** Document ID
*   `approvedSuggestions` **[Object][406]** All approved suggestions

Returns **[Promise][409]<[Object][406]>** Complete merge result

## summarizeThread

Summarize a conversation thread

### Parameters

*   `messages` **[Array][413]** Conversation messages
*   `systemsContext` **[Array][413]** Systems context (optional, default `[]`)

Returns **[Promise][409]<[string][407]>** Generated summary

## generateThreadName

Generate a chat name for a thread

### Parameters

*   `messages` **[Array][413]** Conversation messages
*   `systemsContext` **[Array][413]** Systems context (optional, default `[]`)

Returns **[Promise][409]<[string][407]>** Generated chat name

## generateSystemSummary

Generate asset summary for a specific system

### Parameters

*   `assetUid` **[string][407]** Asset UID
*   `systemsContext` **[Array][413]** Systems context (optional, default `[]`)

Returns **[Promise][409]<[string][407]>** Generated asset summary

## shouldSummarizeThread

Check if thread should be summarized based on message count

### Parameters

*   `messageCount` **[number][408]** Current message count
*   `options` **[Object][406]** Options (optional, default `{}`)

    *   `options.summaryFrequency` **[number][408]** Frequency for summarization

Returns **[boolean][412]** True if should summarize

## getSummarizationMetadata

Get summarization metadata for a thread

### Parameters

*   `messages` **[Array][413]** Conversation messages
*   `systemsContext` **[Array][413]** Systems context (optional, default `[]`)

Returns **[Object][406]** Summarization metadata

## refreshKnowledgeFactsView

Refresh the knowledge\_facts materialized view
This should be called after approving suggestions to update the fact-first retrieval

## refreshKnowledgeFactsViewSafe

Refresh the knowledge\_facts view with error handling
Returns success/failure without throwing

## getViewRefreshStats

Get view refresh statistics

## checkViewHealth

Check if the knowledge\_facts view exists and is accessible

##

Standalone Job Processor Worker
Runs the job processor as a dedicated Node process
Use when deploying as a separate container or process manager

## processor

This file runs the job processor as a dedicated Node process.
Use when deploying as a separate container or process manager.

## ensureLexicons

Ensure critical lexicon files exist with sensible defaults

Returns **[Promise][409]\<void>**&#x20;

## ensureFile

Ensure a file exists, create with default content if missing

### Parameters

*   `relPath` **[string][407]** Relative file path
*   `seedObj` **[Object][406]** Default object to write if file doesn't exist

Returns **[Promise][409]\<void>**&#x20;

## defaultMaintenance

Default maintenance lexicon content

Returns **[Object][406]** Default maintenance configuration

## defaultUnits

Default units lexicon content

Returns **[Object][406]** Default units configuration

## isFollowUpQuestion

Check if a query is a follow-up question that needs context

### Parameters

*   `query` **[string][407]** The user query

Returns **[boolean][412]** True if it's a follow-up question

## containsAmbiguousPronoun

Check if query contains ambiguous pronouns

### Parameters

*   `query` **[string][407]** The user query

Returns **[boolean][412]** True if contains ambiguous pronouns

## extractEquipmentTerms

Extract equipment terms from query by removing common prefixes

### Parameters

*   `query` **[string][407]** The user query

Returns **[string][407]** Cleaned query with equipment terms

## hasExistingSystemsContext

Check if we have existing systems context from thread metadata or recent messages

### Parameters

*   `threadMetadata` **[Object][406]** Thread metadata
*   `recentMessages` **[Array][413]** Recent messages

Returns **[boolean][412]** True if we have existing systems context

## getExistingSystemsContext

Get existing systems context from thread metadata or recent messages

### Parameters

*   `threadMetadata` **[Object][406]** Thread metadata
*   `recentMessages` **[Array][413]** Recent messages

Returns **[Array][413]** Systems context array

## contextRewrite

Rewrite query with systems context for better understanding

### Parameters

*   `query` **[string][407]** The user query
*   `systemsContext` **[Array][413]** Systems context array

Returns **[string][407]** Rewritten query with context

## withTimeout

Create timeout wrapper for promises

### Parameters

*   `promise` **[Promise][409]** The promise to wrap
*   `ms` **[number][408]** Timeout in milliseconds
*   `onTimeoutMsg` **[string][407]** Message for timeout error (optional, default `'Timed out'`)

Returns **[Promise][409]** Promise with timeout

## formatFactAnswer

Format a fact match into a user-friendly answer

### Parameters

*   `fact` &#x20;

## formatSpecAnswer

Format spec suggestion into answer

### Parameters

*   `fact` &#x20;

## formatIntentAnswer

Format intent hint into answer

### Parameters

*   `fact` &#x20;

## formatGoldenTestAnswer

Format golden test into answer

### Parameters

*   `fact` &#x20;

## formatMultipleFacts

Format multiple facts into a comprehensive answer

### Parameters

*   `facts` &#x20;
*   `query` &#x20;

## FuzzyMatcher

Fuzzy matching utility for handling typos in maintenance tokens and units
Uses Levenshtein distance algorithm for approximate string matching

### Parameters

*   `options`   (optional, default `{}`)

### levenshteinDistance

Calculate Levenshtein distance between two strings

#### Parameters

*   `a` **[string][407]** First string
*   `b` **[string][407]** Second string

Returns **[number][408]** Edit distance

### findBestMatch

Find the best fuzzy match for input against a list of candidates

#### Parameters

*   `input` **[string][407]** Input string to match
*   `candidates` **[Array][413]<[string][407]>** Array of candidate strings

Returns **([Object][406] | null)** Best match object or null if no good match found

### findMultipleMatches

Find multiple fuzzy matches above confidence threshold

#### Parameters

*   `input` **[string][407]** Input string to match
*   `candidates` **[Array][413]<[string][407]>** Array of candidate strings

Returns **[Array][413]** Array of match objects sorted by confidence

### isLikelyTypo

Check if input is likely a typo of any candidate

#### Parameters

*   `input` **[string][407]** Input string to check
*   `candidates` **[Array][413]<[string][407]>** Array of candidate strings

Returns **[boolean][412]** True if likely typo found

## decideStyle

Determines the appropriate style preset based on the user's question

### Parameters

*   `question` **[string][407]** The user's question

Returns **(`"specBrief"` | `"steps"` | `"bullets3"` | `"brief"` | `"technical"`)** The style preset to use

## getStyleOpening

Gets a random opening phrase for the given style

### Parameters

*   `style` **[string][407]** The style preset

Returns **[string][407]** A random opening phrase

## startTimer

Start timing an operation

### Parameters

*   `operation` **[string][407]** Operation name
*   `tags` **[Object][406]** Additional tags for the operation (optional, default `{}`)

## endTimer

End timing an operation and record the duration

### Parameters

*   `operation` **[string][407]** Operation name
*   `tags` **[Object][406]** Additional tags for the operation (optional, default `{}`)

Returns **[number][408]** Duration in milliseconds

## recordMetric

Record a metric value

### Parameters

*   `name` **[string][407]** Metric name
*   `value` **[number][408]** Metric value
*   `tags` **[Object][406]** Additional tags (optional, default `{}`)

## incrementCounter

Increment a counter metric

### Parameters

*   `name` **[string][407]** Counter name
*   `tags` **[Object][406]** Additional tags (optional, default `{}`)
*   `increment` **[number][408]** Increment amount (default: 1) (optional, default `1`)

## recordSuccess

Record a success/failure event

### Parameters

*   `operation` **[string][407]** Operation name
*   `success` **[boolean][412]** Whether the operation succeeded
*   `tags` **[Object][406]** Additional tags (optional, default `{}`)

## getMetrics

Get all metrics

Returns **[Object][406]** All collected metrics

## getOperationSummary

Get metrics summary for specific operations

### Parameters

*   `operation` **[string][407]** Operation name

Returns **[Object][406]** Metrics summary

## getSuccessRate

Get success rate for an operation

### Parameters

*   `operation` **[string][407]** Operation name

Returns **[number][408]** Success rate (0-1)

## reset

Reset all metrics

## \_buildKey

Build a key for metrics storage

### Parameters

*   `name` **[string][407]** Metric name
*   `tags` **[Object][406]** Tags

Returns **[string][407]** Storage key

## getDashboardMetrics

Get metrics in a format suitable for monitoring dashboards

Returns **[Object][406]** Dashboard-ready metrics

## \_calculatePerformanceScore

Calculate performance score based on success rate and duration

### Parameters

*   `successRate` **[number][408]** Success rate (0-1)
*   `avgDuration` **[number][408]** Average duration in ms
*   `targetDuration` **[number][408]** Target duration in ms

Returns **[number][408]** Performance score (0-100)

## getPerformanceMetrics

Get detailed performance metrics for a specific operation

### Parameters

*   `operation` **[string][407]** Operation name

Returns **[Object][406]** Detailed performance metrics

## createSnapshot

Create a snapshot of specified files

### Parameters

*   `files` **[Array][413]<[string][407]>** Array of file paths to snapshot (relative to project root)

Returns **[Promise][409]<[Object][406]>** Snapshot result with ID and directory

## rollbackTo

Restore files from a snapshot

### Parameters

*   `snapshotId` **[string][407]** Snapshot ID to restore from

Returns **[Promise][409]<[Object][406]>** Restore result with restored files count

## listSnapshots

List all available snapshots

Returns **[Promise][409]<[Array][413]>** Array of snapshot information

## deleteSnapshot

Delete a snapshot

### Parameters

*   `snapshotId` **[string][407]** Snapshot ID to delete

Returns **[Promise][409]<[Object][406]>** Deletion result

## getSnapshotInfo

Get snapshot information

### Parameters

*   `snapshotId` **[string][407]** Snapshot ID

Returns **[Promise][409]<[Object][406]>** Snapshot information

## cleanupSnapshots

Clean up old snapshots (keep only the most recent N)

### Parameters

*   `keepCount` **[number][408]** Number of snapshots to keep (default: 10) (optional, default `10`)

Returns **[Promise][409]<[Object][406]>** Cleanup result

## listFiles

Helper function to recursively list files in a directory

### Parameters

*   `dir` **[string][407]** Directory path
*   `prefix` **[string][407]** Path prefix for relative paths (optional, default `''`)

Returns **[Promise][409]<[Array][413]>** Array of relative file paths

## loadMaintenanceLexicon

Load maintenance lexicon from config file

Returns **[Object][406]** Maintenance lexicon with tokens and regexes

## extractMaintenanceTerms

Extract potential maintenance terms from text

### Parameters

*   `text` **[string][407]** Text to analyze

Returns **[Array][413]<[string][407]>** Array of potential maintenance terms

## checkMaintenanceContent

Check if text contains maintenance-related content using exact and fuzzy matching

### Parameters

*   `text` **[string][407]** Text to check
*   `lexicon` **[Object][406]** Maintenance lexicon

Returns **[Object][406]** Result with match details

## filterSpecLike

Enhanced spec filter that includes maintenance content detection

### Parameters

*   `chunks` **[Array][413]** Array of chunks to filter

Returns **[Array][413]** Filtered chunks that contain specs or maintenance content

## loadUnitsLexicon

Load units lexicon from config file

Returns **[Object][406]** Units lexicon with canonical forms and aliases

## getUnitCategory

Get the unit category for a canonical unit

### Parameters

*   `canonical` **[string][407]** Canonical unit form
*   `lexicon` **[Object][406]** Units lexicon

Returns **[string][407]** Unit category or 'unknown'

## checkDisambiguation

Check if context hints suggest a specific unit meaning

### Parameters

*   `unit` **[string][407]** Unit to check
*   `hint` **[string][407]** Context hint
*   `lexicon` **[Object][406]** Units lexicon

Returns **([string][407] | null)** Suggested canonical form or null

## normalizeUnitToken

Normalize a unit token with fuzzy matching support

### Parameters

*   `token` **[string][407]** Unit token to normalize
*   `options` **[Object][406]** Options for normalization (optional, default `{}`)

    *   `options.hint` **[string][407]** Context hint for disambiguation
    *   `options.fuzzy` **[boolean][412]** Enable fuzzy matching (default: true)

Returns **[Object][406]** Normalization result

## normalizeUnitsInText

Normalize multiple unit tokens in a text

### Parameters

*   `text` **[string][407]** Text containing unit tokens
*   `options` **[Object][406]** Options for normalization (optional, default `{}`)

Returns **[Array][413]** Array of normalization results

## getUnitCategories

Get all available unit categories

Returns **[Array][413]** Array of unit categories

## getUnitsInCategory

Get all units in a specific category

### Parameters

*   `category` **[string][407]** Unit category

Returns **[Array][413]** Array of units in the category

[1]: #oaijson

[2]: #parameters

[3]: #oaitext

[4]: #parameters-1

[5]: #makeopenaicall

[6]: #parameters-2

[7]: #truncatecontent

[8]: #parameters-3

[9]: #extracttextpreviewfrompdf

[10]: #parameters-4

[11]: #optionaladmingate

[12]: #parameters-5

[13]: #methodnotallowed

[14]: #parameters-6

[15]: #securityheaders

[16]: #parameters-7

[17]: #basicratelimit

[18]: #parameters-8

[19]: #loadchatthread

[20]: #parameters-9

[21]: #addbubble

[22]: #parameters-10

[23]: #hydrateincludes

[24]: #hydrateincludes-1

[25]: #parameters-11

[26]: #route_sel

[27]: #init

[28]: #parameters-12

[29]: #init-1

[30]: #parameters-13

[31]: #init-2

[32]: #parameters-14

[33]: #init-3

[34]: #parameters-15

[35]: #init-4

[36]: #parameters-16

[37]: #init-5

[38]: #parameters-17

[39]: #closeresultsmodal

[40]: #addspectag

[41]: #parameters-18

[42]: #getallintentroutes

[43]: #parameters-19

[44]: #getintentroutebyid

[45]: #parameters-20

[46]: #createintentroute

[47]: #parameters-21

[48]: #updateintentroute

[49]: #parameters-22

[50]: #deleteintentroute

[51]: #parameters-23

[52]: #findmatchingroute

[53]: #parameters-24

[54]: #getintentroutestats

[55]: #logger

[56]: #logger-1

[57]: #logger-2

[58]: #logger-3

[59]: #logger-4

[60]: #logger-5

[61]: #findfactmatchbyquery

[62]: #parameters-25

[63]: #findfactsbydocument

[64]: #parameters-26

[65]: #findfactsbytype

[66]: #parameters-27

[67]: #getfactstatistics

[68]: #getallplaybooks

[69]: #parameters-28

[70]: #getplaybookbyid

[71]: #parameters-29

[72]: #createplaybook

[73]: #parameters-30

[74]: #updateplaybook

[75]: #parameters-31

[76]: #deleteplaybook

[77]: #parameters-32

[78]: #getplaybookhintsforgeneration

[79]: #parameters-33

[80]: #getplaybookstats

[81]: #checkplaybookexists

[82]: #parameters-34

[83]: #insertspecsuggestion

[84]: #parameters-35

[85]: #insertgoldentest

[86]: #parameters-36

[87]: #insertplaybookhint

[88]: #parameters-37

[89]: #insertentitycandidate

[90]: #parameters-38

[91]: #insertdipreview

[92]: #parameters-39

[93]: #getsupabasestorageclient

[94]: #getsupabasestorageclient-1

[95]: #lookupsystembymanufacturerandmodel

[96]: #parameters-40

[97]: #getsystembyuid

[98]: #parameters-41

[99]: #updatespeckeywords

[100]: #parameters-42

[101]: #listminimal

[102]: #get

[103]: #get-1

[104]: #get-2

[105]: #get-3

[106]: #get-4

[107]: #get-5

[108]: #get-6

[109]: #get-7

[110]: #get-8

[111]: #get-9

[112]: #get-10

[113]: #get-11

[114]: #router

[115]: #router-1

[116]: #router-2

[117]: #router-3

[118]: #router-4

[119]: #post

[120]: #post-1

[121]: #post-2

[122]: #post-3

[123]: #post-4

[124]: #checkfileexists

[125]: #parameters-43

[126]: #delete

[127]: #delete-1

[128]: #expressjson

[129]: #systemuid

[130]: #hashoruuid

[131]: #z

[132]: #validatedip

[133]: #parameters-44

[134]: #validatesuggestions

[135]: #parameters-45

[136]: #validateapplyrequest

[137]: #parameters-46

[138]: #validaterollbackrequest

[139]: #parameters-47

[140]: #createdefaultdip

[141]: #parameters-48

[142]: #createdefaultsuggestions

[143]: #parameters-49

[144]: #speckeywordschema

[145]: #acceptspecpayload

[146]: #uploaddocumentschema

[147]: #documentuploadrequestschema

[148]: #systemmetadataschema

[149]: #documentcreationschema

[150]: #generateenhancedassistantresponse

[151]: #parameters-50

[152]: #extractpressurespecs

[153]: #parameters-51

[154]: #generatepressureresponse

[155]: #parameters-52

[156]: #generatestandardresponse

[157]: #parameters-53

[158]: #generatestructuredcontent

[159]: #parameters-54

[160]: #detectresponsestyle

[161]: #parameters-55

[162]: #checkserviceavailability

[163]: #processusermessage

[164]: #parameters-56

[165]: #processusermessage-1

[166]: #parameters-57

[167]: #handlespecialintent

[168]: #parameters-58

[169]: #bootstrapcontext

[170]: #parameters-59

[171]: #getorcreatesessionandthread

[172]: #parameters-60

[173]: #performpineconeretrieval

[174]: #parameters-61

[175]: #createfactresponse

[176]: #parameters-62

[177]: #createfactresponse-1

[178]: #parameters-63

[179]: #storemessagesandupdatethread

[180]: #parameters-64

[181]: #handlesummarizationifneeded

[182]: #parameters-65

[183]: #handlesummarizationintent

[184]: #parameters-66

[185]: #handleassetsummaryintent

[186]: #parameters-67

[187]: #generatedipandsuggestions

[188]: #parameters-68

[189]: #getdocumentchunks

[190]: #parameters-69

[191]: #generatedip

[192]: #parameters-70

[193]: #generatesuggestions

[194]: #parameters-71

[195]: #extractentities

[196]: #parameters-72

[197]: #extractspecifications

[198]: #parameters-73

[199]: #extractmaintenance

[200]: #parameters-74

[201]: #generateentityaliases

[202]: #parameters-75

[203]: #generateintenthints

[204]: #parameters-76

[205]: #generateplaybooksuggestions

[206]: #parameters-77

[207]: #generateunitsuggestions

[208]: #parameters-78

[209]: #generategoldentests

[210]: #parameters-79

[211]: #calculateconfidencescore

[212]: #parameters-80

[213]: #calculatecompletenessscore

[214]: #parameters-81

[215]: #storedip

[216]: #parameters-82

[217]: #storesuggestions

[218]: #parameters-83

[219]: #generatedip-1

[220]: #parameters-84

[221]: #rundippacket

[222]: #parameters-85

[223]: #checkdipavailability

[224]: #getdipstats

[225]: #parameters-86

[226]: #extracttextpreview

[227]: #parameters-87

[228]: #extractfromdatabase

[229]: #parameters-88

[230]: #extractfromstorage

[231]: #parameters-89

[232]: #getfromcache

[233]: #parameters-90

[234]: #setcache

[235]: #parameters-91

[236]: #gettextextractionmetrics

[237]: #cleartextcache

[238]: #getcachestats

[239]: #retrievewithspecbias

[240]: #parameters-92

[241]: #retrievewithspecbias-1

[242]: #parameters-93

[243]: #findfactmatch

[244]: #parameters-94

[245]: #getfactfirstresponse

[246]: #parameters-95

[247]: #shouldattemptfactfirst

[248]: #parameters-96

[249]: #classifyuserintent

[250]: #parameters-97

[251]: #routequery

[252]: #parameters-98

[253]: #searchdocuments

[254]: #parameters-99

[255]: #normalizequery

[256]: #parameters-100

[257]: #fs

[258]: #fs-1

[259]: #fs-2

[260]: #fs-3

[261]: #applysuggestions

[262]: #parameters-101

[263]: #readjson

[264]: #parameters-102

[265]: #writejson

[266]: #parameters-103

[267]: #mergejsonmaparray

[268]: #parameters-104

[269]: #mergeintenthints

[270]: #parameters-105

[271]: #mergemaintenancelexicon

[272]: #parameters-106

[273]: #mergeunits

[274]: #parameters-107

[275]: #writegoldentests

[276]: #parameters-108

[277]: #safename

[278]: #parameters-109

[279]: #suggestionsmergeservice

[280]: #mergespecsuggestions

[281]: #parameters-110

[282]: #mergeentitycandidates

[283]: #parameters-111

[284]: #mergeplaybookhints

[285]: #parameters-112

[286]: #acceptspecsuggestion

[287]: #parameters-113

[288]: #upsertspec

[289]: #parameters-114

[290]: #mergeallsuggestions

[291]: #parameters-115

[292]: #summarizethread

[293]: #parameters-116

[294]: #generatethreadname

[295]: #parameters-117

[296]: #generatesystemsummary

[297]: #parameters-118

[298]: #shouldsummarizethread

[299]: #parameters-119

[300]: #getsummarizationmetadata

[301]: #parameters-120

[302]: #refreshknowledgefactsview

[303]: #refreshknowledgefactsviewsafe

[304]: #getviewrefreshstats

[305]: #checkviewhealth

[306]: #

[307]: #processor

[308]: #ensurelexicons

[309]: #ensurefile

[310]: #parameters-121

[311]: #defaultmaintenance

[312]: #defaultunits

[313]: #isfollowupquestion

[314]: #parameters-122

[315]: #containsambiguouspronoun

[316]: #parameters-123

[317]: #extractequipmentterms

[318]: #parameters-124

[319]: #hasexistingsystemscontext

[320]: #parameters-125

[321]: #getexistingsystemscontext

[322]: #parameters-126

[323]: #contextrewrite

[324]: #parameters-127

[325]: #withtimeout

[326]: #parameters-128

[327]: #formatfactanswer

[328]: #parameters-129

[329]: #formatspecanswer

[330]: #parameters-130

[331]: #formatintentanswer

[332]: #parameters-131

[333]: #formatgoldentestanswer

[334]: #parameters-132

[335]: #formatmultiplefacts

[336]: #parameters-133

[337]: #fuzzymatcher

[338]: #parameters-134

[339]: #levenshteindistance

[340]: #parameters-135

[341]: #findbestmatch

[342]: #parameters-136

[343]: #findmultiplematches

[344]: #parameters-137

[345]: #islikelytypo

[346]: #parameters-138

[347]: #decidestyle

[348]: #parameters-139

[349]: #getstyleopening

[350]: #parameters-140

[351]: #starttimer

[352]: #parameters-141

[353]: #endtimer

[354]: #parameters-142

[355]: #recordmetric

[356]: #parameters-143

[357]: #incrementcounter

[358]: #parameters-144

[359]: #recordsuccess

[360]: #parameters-145

[361]: #getmetrics

[362]: #getoperationsummary

[363]: #parameters-146

[364]: #getsuccessrate

[365]: #parameters-147

[366]: #reset

[367]: #_buildkey

[368]: #parameters-148

[369]: #getdashboardmetrics

[370]: #_calculateperformancescore

[371]: #parameters-149

[372]: #getperformancemetrics

[373]: #parameters-150

[374]: #createsnapshot

[375]: #parameters-151

[376]: #rollbackto

[377]: #parameters-152

[378]: #listsnapshots

[379]: #deletesnapshot

[380]: #parameters-153

[381]: #getsnapshotinfo

[382]: #parameters-154

[383]: #cleanupsnapshots

[384]: #parameters-155

[385]: #listfiles

[386]: #parameters-156

[387]: #loadmaintenancelexicon

[388]: #extractmaintenanceterms

[389]: #parameters-157

[390]: #checkmaintenancecontent

[391]: #parameters-158

[392]: #filterspeclike

[393]: #parameters-159

[394]: #loadunitslexicon

[395]: #getunitcategory

[396]: #parameters-160

[397]: #checkdisambiguation

[398]: #parameters-161

[399]: #normalizeunittoken

[400]: #parameters-162

[401]: #normalizeunitsintext

[402]: #parameters-163

[403]: #getunitcategories

[404]: #getunitsincategory

[405]: #parameters-164

[406]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[407]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[408]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[409]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[410]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[411]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error

[412]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[413]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[414]: https://nodejs.org/api/buffer.html
