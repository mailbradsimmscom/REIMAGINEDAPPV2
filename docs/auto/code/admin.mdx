# `admin.js`

- **Path**: `src/middleware/admin.js`
- **Exports**: adminOnly
- **Imports**:
  - `node:crypto`
  - `../config/env.js`
  - `../utils/logger.js`
  - `../constants/errorCodes.js`

## Express Routes
_None detected_

## Raw Content

```js
import crypto from 'node:crypto';
import { getEnv } from '../config/env.js';
import { logger } from '../utils/logger.js';
import { ERR } from '../constants/errorCodes.js';

function readAdminToken(req) {
  const h = req.headers;
  const x = h['x-admin-token'];
  const auth = h['authorization'];
  if (x && typeof x === 'string') return x.trim();
  if (auth && typeof auth === 'string') {
    const m = auth.match(/^Bearer\s+(.+)$/i);
    if (m) return m[1].trim();
  }
  return null;
}

function mask(token) {
  if (!token) return 'not-set';
  if (token.length <= 8) return `${'*'.repeat(Math.max(0, token.length - 2))}${token.slice(-2)}`;
  return `${token.slice(0,4)}â€¦${token.slice(-4)}`;
}

function tokenHash(token) {
  return token ? crypto.createHash('sha256').update(token).digest('hex').slice(0,12) : 'none';
}

export function adminGate(req, res, next) {
  const env = getEnv({ loose: true });
  const expected = env.ADMIN_TOKEN;
  const supplied = readAdminToken(req);

  if (!expected) {

...
```
